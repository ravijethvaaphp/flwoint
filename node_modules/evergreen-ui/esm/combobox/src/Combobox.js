import _extends from "@babel/runtime/helpers/esm/extends";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _classCallCheck from "@babel/runtime/helpers/esm/classCallCheck";
import _createClass from "@babel/runtime/helpers/esm/createClass";
import _possibleConstructorReturn from "@babel/runtime/helpers/esm/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/esm/getPrototypeOf";
import _assertThisInitialized from "@babel/runtime/helpers/esm/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/esm/inherits";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import React, { PureComponent } from 'react';
import PropTypes from 'prop-types';
import Box, { dimensions, spacing, position, layout } from 'ui-box';
import { Autocomplete } from '../../autocomplete';
import { TextInput } from '../../text-input';
import { IconButton } from '../../buttons';
import deprecated from '../../lib/deprecated';
import { CaretDownIcon } from '../../icons';

var Combobox =
/*#__PURE__*/
function (_PureComponent) {
  _inherits(Combobox, _PureComponent);

  function Combobox(props, context) {
    var _this;

    _classCallCheck(this, Combobox);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(Combobox).call(this, props, context));

    _defineProperty(_assertThisInitialized(_this), "handleStateChange", function (changes) {
      if (Object.prototype.hasOwnProperty.call(changes, 'isOpen')) {
        if (!changes.isOpen) {
          _this.setState({
            isOpenedByButton: false
          });
        }
      }
    });

    _this.state = {
      isOpenedByButton: false
    };
    return _this;
  }

  _createClass(Combobox, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          items = _this$props.items,
          selectedItem = _this$props.selectedItem,
          defaultSelectedItem = _this$props.defaultSelectedItem,
          initialSelectedItem = _this$props.initialSelectedItem,
          itemToString = _this$props.itemToString,
          width = _this$props.width,
          height = _this$props.height,
          onChange = _this$props.onChange,
          placeholder = _this$props.placeholder,
          inputProps = _this$props.inputProps,
          buttonProps = _this$props.buttonProps,
          openOnFocus = _this$props.openOnFocus,
          autocompleteProps = _this$props.autocompleteProps,
          isLoading = _this$props.isLoading,
          props = _objectWithoutProperties(_this$props, ["items", "selectedItem", "defaultSelectedItem", "initialSelectedItem", "itemToString", "width", "height", "onChange", "placeholder", "inputProps", "buttonProps", "openOnFocus", "autocompleteProps", "isLoading"]);

      var disabled = props.disabled || isLoading;
      return React.createElement(Autocomplete, _extends({
        items: items,
        selectedItem: selectedItem,
        initialSelectedItem: initialSelectedItem || defaultSelectedItem,
        itemToString: itemToString,
        onChange: onChange,
        onStateChange: this.handleStateChange,
        isFilterDisabled: this.state.isOpenedByButton
      }, autocompleteProps), function (_ref) {
        var getRef = _ref.getRef,
            isShown = _ref.isShown,
            openMenu = _ref.openMenu,
            inputValue = _ref.inputValue,
            getInputProps = _ref.getInputProps,
            getToggleButtonProps = _ref.getToggleButtonProps,
            clearSelection = _ref.clearSelection;
        return React.createElement(Box, _extends({
          innerRef: function innerRef(ref) {
            return getRef(ref);
          },
          display: "inline-flex",
          width: width
        }, props), React.createElement(TextInput, _extends({
          width: 0,
          flex: 1,
          height: height,
          value: inputValue,
          borderTopRightRadius: 0,
          borderBottomRightRadius: 0,
          disabled: disabled
        }, getInputProps(_objectSpread({}, inputProps, {
          placeholder: placeholder,
          onFocus: function onFocus() {
            if (openOnFocus) openMenu();
          },
          onChange: function onChange(e) {
            if (_this2.state.isOpenedByButton) {
              _this2.setState({
                isOpenedByButton: false
              });
            }

            if (e.target.value.trim() === '') {
              // Prevent the selected item from sticking around
              clearSelection();
            }
          }
        })))), React.createElement(IconButton, _extends({
          color: "muted",
          icon: isLoading ? null : CaretDownIcon,
          appearance: "default",
          height: height,
          marginLeft: -1,
          paddingLeft: isLoading ? 12 : 0,
          paddingRight: 0,
          borderTopLeftRadius: 0,
          borderBottomLeftRadius: 0,
          disabled: disabled,
          isLoading: isLoading
        }, getToggleButtonProps(_objectSpread({}, buttonProps, {
          onClick: function onClick() {
            if (!isShown) {
              _this2.setState({
                isOpenedByButton: true
              });
            }
          }
        })))));
      });
    }
  }]);

  return Combobox;
}(PureComponent);

Combobox.displayName = "Combobox";

_defineProperty(Combobox, "propTypes", _objectSpread({}, dimensions.propTypes, {}, spacing.propTypes, {}, position.propTypes, {}, layout.propTypes, {
  /**
   * The options to show in the menu.
   */
  items: PropTypes.array.isRequired,

  /**
   * The selected item when controlled.
   */
  selectedItem: PropTypes.any,

  /**
   * Function called when value changes.
   */
  onChange: PropTypes.func,

  /**
   * When true, open the autocomplete on focus.
   */
  openOnFocus: PropTypes.bool,

  /**
   * Default selected item when uncontrolled.
   */
  initialSelectedItem: PropTypes.any,

  /**
   * Default selected item when uncontrolled (deprecated)
   */
  defaultSelectedItem: deprecated(PropTypes.any, 'Use "initialSelectedItem" instead.'),

  /**
   * The placeholder text when there is no value present.
   */
  placeholder: PropTypes.string,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: PropTypes.func,

  /**
   * Properties forwarded to the input. Use with caution.
   */
  inputProps: PropTypes.object,

  /**
   * Properties forwarded to the button. Use with caution.
   */
  buttonProps: PropTypes.object,

  /**
   * Properties forwarded to the autocomplete component. Use with caution.
   */
  autocompleteProps: PropTypes.object,

  /**
   * Makes the input element disabled.
   */
  disabled: PropTypes.bool,

  /**
   * When true, show a loading spinner. This also disables the button.
   */
  isLoading: PropTypes.bool
}));

_defineProperty(Combobox, "defaultProps", {
  width: 240,
  openOnFocus: false,
  disabled: false,
  isLoading: false
});

export { Combobox as default };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21ib2JveC9zcmMvQ29tYm9ib3guanMiXSwibmFtZXMiOlsiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwiQm94IiwiZGltZW5zaW9ucyIsInNwYWNpbmciLCJwb3NpdGlvbiIsImxheW91dCIsIkF1dG9jb21wbGV0ZSIsIlRleHRJbnB1dCIsIkljb25CdXR0b24iLCJkZXByZWNhdGVkIiwiQ2FyZXREb3duSWNvbiIsIkNvbWJvYm94IiwicHJvcHMiLCJjb250ZXh0IiwiY2hhbmdlcyIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImlzT3BlbiIsInNldFN0YXRlIiwiaXNPcGVuZWRCeUJ1dHRvbiIsInN0YXRlIiwiaXRlbXMiLCJzZWxlY3RlZEl0ZW0iLCJkZWZhdWx0U2VsZWN0ZWRJdGVtIiwiaW5pdGlhbFNlbGVjdGVkSXRlbSIsIml0ZW1Ub1N0cmluZyIsIndpZHRoIiwiaGVpZ2h0Iiwib25DaGFuZ2UiLCJwbGFjZWhvbGRlciIsImlucHV0UHJvcHMiLCJidXR0b25Qcm9wcyIsIm9wZW5PbkZvY3VzIiwiYXV0b2NvbXBsZXRlUHJvcHMiLCJpc0xvYWRpbmciLCJkaXNhYmxlZCIsImhhbmRsZVN0YXRlQ2hhbmdlIiwiZ2V0UmVmIiwiaXNTaG93biIsIm9wZW5NZW51IiwiaW5wdXRWYWx1ZSIsImdldElucHV0UHJvcHMiLCJnZXRUb2dnbGVCdXR0b25Qcm9wcyIsImNsZWFyU2VsZWN0aW9uIiwicmVmIiwib25Gb2N1cyIsImUiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRyaW0iLCJvbkNsaWNrIiwicHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwiYW55IiwiZnVuYyIsImJvb2wiLCJzdHJpbmciLCJvYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFnQkMsYUFBaEIsUUFBcUMsT0FBckM7QUFDQSxPQUFPQyxTQUFQLE1BQXNCLFlBQXRCO0FBQ0EsT0FBT0MsR0FBUCxJQUFjQyxVQUFkLEVBQTBCQyxPQUExQixFQUFtQ0MsUUFBbkMsRUFBNkNDLE1BQTdDLFFBQTJELFFBQTNEO0FBQ0EsU0FBU0MsWUFBVCxRQUE2QixvQkFBN0I7QUFDQSxTQUFTQyxTQUFULFFBQTBCLGtCQUExQjtBQUNBLFNBQVNDLFVBQVQsUUFBMkIsZUFBM0I7QUFDQSxPQUFPQyxVQUFQLE1BQXVCLHNCQUF2QjtBQUNBLFNBQVNDLGFBQVQsUUFBOEIsYUFBOUI7O0lBRXFCQyxROzs7OztBQXVGbkIsb0JBQVlDLEtBQVosRUFBbUJDLE9BQW5CLEVBQTRCO0FBQUE7O0FBQUE7O0FBQzFCLGtGQUFNRCxLQUFOLEVBQWFDLE9BQWI7O0FBRDBCLHdFQU9SLFVBQUFDLE9BQU8sRUFBSTtBQUM3QixVQUFJQyxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ0osT0FBckMsRUFBOEMsUUFBOUMsQ0FBSixFQUE2RDtBQUMzRCxZQUFJLENBQUNBLE9BQU8sQ0FBQ0ssTUFBYixFQUFxQjtBQUNuQixnQkFBS0MsUUFBTCxDQUFjO0FBQUVDLFlBQUFBLGdCQUFnQixFQUFFO0FBQXBCLFdBQWQ7QUFDRDtBQUNGO0FBQ0YsS0FiMkI7O0FBRTFCLFVBQUtDLEtBQUwsR0FBYTtBQUNYRCxNQUFBQSxnQkFBZ0IsRUFBRTtBQURQLEtBQWI7QUFGMEI7QUFLM0I7Ozs7NkJBVVE7QUFBQTs7QUFBQSx3QkFpQkgsS0FBS1QsS0FqQkY7QUFBQSxVQUVMVyxLQUZLLGVBRUxBLEtBRks7QUFBQSxVQUdMQyxZQUhLLGVBR0xBLFlBSEs7QUFBQSxVQUlMQyxtQkFKSyxlQUlMQSxtQkFKSztBQUFBLFVBS0xDLG1CQUxLLGVBS0xBLG1CQUxLO0FBQUEsVUFNTEMsWUFOSyxlQU1MQSxZQU5LO0FBQUEsVUFPTEMsS0FQSyxlQU9MQSxLQVBLO0FBQUEsVUFRTEMsTUFSSyxlQVFMQSxNQVJLO0FBQUEsVUFTTEMsUUFUSyxlQVNMQSxRQVRLO0FBQUEsVUFVTEMsV0FWSyxlQVVMQSxXQVZLO0FBQUEsVUFXTEMsVUFYSyxlQVdMQSxVQVhLO0FBQUEsVUFZTEMsV0FaSyxlQVlMQSxXQVpLO0FBQUEsVUFhTEMsV0FiSyxlQWFMQSxXQWJLO0FBQUEsVUFjTEMsaUJBZEssZUFjTEEsaUJBZEs7QUFBQSxVQWVMQyxTQWZLLGVBZUxBLFNBZks7QUFBQSxVQWdCRnhCLEtBaEJFOztBQW1CUCxVQUFNeUIsUUFBUSxHQUFHekIsS0FBSyxDQUFDeUIsUUFBTixJQUFrQkQsU0FBbkM7QUFFQSxhQUNFLG9CQUFDLFlBQUQ7QUFDRSxRQUFBLEtBQUssRUFBRWIsS0FEVDtBQUVFLFFBQUEsWUFBWSxFQUFFQyxZQUZoQjtBQUdFLFFBQUEsbUJBQW1CLEVBQUVFLG1CQUFtQixJQUFJRCxtQkFIOUM7QUFJRSxRQUFBLFlBQVksRUFBRUUsWUFKaEI7QUFLRSxRQUFBLFFBQVEsRUFBRUcsUUFMWjtBQU1FLFFBQUEsYUFBYSxFQUFFLEtBQUtRLGlCQU50QjtBQU9FLFFBQUEsZ0JBQWdCLEVBQUUsS0FBS2hCLEtBQUwsQ0FBV0Q7QUFQL0IsU0FRTWMsaUJBUk4sR0FVRztBQUFBLFlBQ0NJLE1BREQsUUFDQ0EsTUFERDtBQUFBLFlBRUNDLE9BRkQsUUFFQ0EsT0FGRDtBQUFBLFlBR0NDLFFBSEQsUUFHQ0EsUUFIRDtBQUFBLFlBSUNDLFVBSkQsUUFJQ0EsVUFKRDtBQUFBLFlBS0NDLGFBTEQsUUFLQ0EsYUFMRDtBQUFBLFlBTUNDLG9CQU5ELFFBTUNBLG9CQU5EO0FBQUEsWUFPQ0MsY0FQRCxRQU9DQSxjQVBEO0FBQUEsZUFTQyxvQkFBQyxHQUFEO0FBQ0UsVUFBQSxRQUFRLEVBQUUsa0JBQUFDLEdBQUc7QUFBQSxtQkFBSVAsTUFBTSxDQUFDTyxHQUFELENBQVY7QUFBQSxXQURmO0FBRUUsVUFBQSxPQUFPLEVBQUMsYUFGVjtBQUdFLFVBQUEsS0FBSyxFQUFFbEI7QUFIVCxXQUlNaEIsS0FKTixHQU1FLG9CQUFDLFNBQUQ7QUFDRSxVQUFBLEtBQUssRUFBRSxDQURUO0FBRUUsVUFBQSxJQUFJLEVBQUUsQ0FGUjtBQUdFLFVBQUEsTUFBTSxFQUFFaUIsTUFIVjtBQUlFLFVBQUEsS0FBSyxFQUFFYSxVQUpUO0FBS0UsVUFBQSxvQkFBb0IsRUFBRSxDQUx4QjtBQU1FLFVBQUEsdUJBQXVCLEVBQUUsQ0FOM0I7QUFPRSxVQUFBLFFBQVEsRUFBRUw7QUFQWixXQVFNTSxhQUFhLG1CQUNaWCxVQURZO0FBRWZELFVBQUFBLFdBQVcsRUFBWEEsV0FGZTtBQUdmZ0IsVUFBQUEsT0FBTyxFQUFFLG1CQUFNO0FBQ2IsZ0JBQUliLFdBQUosRUFBaUJPLFFBQVE7QUFDMUIsV0FMYztBQU1mWCxVQUFBQSxRQUFRLEVBQUUsa0JBQUFrQixDQUFDLEVBQUk7QUFDYixnQkFBSSxNQUFJLENBQUMxQixLQUFMLENBQVdELGdCQUFmLEVBQWlDO0FBQy9CLGNBQUEsTUFBSSxDQUFDRCxRQUFMLENBQWM7QUFDWkMsZ0JBQUFBLGdCQUFnQixFQUFFO0FBRE4sZUFBZDtBQUdEOztBQUVELGdCQUFJMkIsQ0FBQyxDQUFDQyxNQUFGLENBQVNDLEtBQVQsQ0FBZUMsSUFBZixPQUEwQixFQUE5QixFQUFrQztBQUNoQztBQUNBTixjQUFBQSxjQUFjO0FBQ2Y7QUFDRjtBQWpCYyxXQVJuQixFQU5GLEVBa0NFLG9CQUFDLFVBQUQ7QUFDRSxVQUFBLEtBQUssRUFBQyxPQURSO0FBRUUsVUFBQSxJQUFJLEVBQUVULFNBQVMsR0FBRyxJQUFILEdBQVUxQixhQUYzQjtBQUdFLFVBQUEsVUFBVSxFQUFDLFNBSGI7QUFJRSxVQUFBLE1BQU0sRUFBRW1CLE1BSlY7QUFLRSxVQUFBLFVBQVUsRUFBRSxDQUFDLENBTGY7QUFNRSxVQUFBLFdBQVcsRUFBRU8sU0FBUyxHQUFHLEVBQUgsR0FBUSxDQU5oQztBQU9FLFVBQUEsWUFBWSxFQUFFLENBUGhCO0FBUUUsVUFBQSxtQkFBbUIsRUFBRSxDQVJ2QjtBQVNFLFVBQUEsc0JBQXNCLEVBQUUsQ0FUMUI7QUFVRSxVQUFBLFFBQVEsRUFBRUMsUUFWWjtBQVdFLFVBQUEsU0FBUyxFQUFFRDtBQVhiLFdBWU1RLG9CQUFvQixtQkFDbkJYLFdBRG1CO0FBRXRCbUIsVUFBQUEsT0FBTyxFQUFFLG1CQUFNO0FBQ2IsZ0JBQUksQ0FBQ1osT0FBTCxFQUFjO0FBQ1osY0FBQSxNQUFJLENBQUNwQixRQUFMLENBQWM7QUFBRUMsZ0JBQUFBLGdCQUFnQixFQUFFO0FBQXBCLGVBQWQ7QUFDRDtBQUNGO0FBTnFCLFdBWjFCLEVBbENGLENBVEQ7QUFBQSxPQVZILENBREY7QUErRUQ7Ozs7RUExTW1DdEIsYTs7QUFBakJZLFE7O2dCQUFBQSxRLGlDQUtkVCxVQUFVLENBQUNtRCxTLE1BQ1hsRCxPQUFPLENBQUNrRCxTLE1BQ1JqRCxRQUFRLENBQUNpRCxTLE1BQ1RoRCxNQUFNLENBQUNnRCxTO0FBRVY7OztBQUdBOUIsRUFBQUEsS0FBSyxFQUFFdkIsU0FBUyxDQUFDc0QsS0FBVixDQUFnQkMsVTs7QUFFdkI7OztBQUdBL0IsRUFBQUEsWUFBWSxFQUFFeEIsU0FBUyxDQUFDd0QsRzs7QUFFeEI7OztBQUdBMUIsRUFBQUEsUUFBUSxFQUFFOUIsU0FBUyxDQUFDeUQsSTs7QUFFcEI7OztBQUdBdkIsRUFBQUEsV0FBVyxFQUFFbEMsU0FBUyxDQUFDMEQsSTs7QUFFdkI7OztBQUdBaEMsRUFBQUEsbUJBQW1CLEVBQUUxQixTQUFTLENBQUN3RCxHOztBQUUvQjs7O0FBR0EvQixFQUFBQSxtQkFBbUIsRUFBRWhCLFVBQVUsQ0FDN0JULFNBQVMsQ0FBQ3dELEdBRG1CLEVBRTdCLG9DQUY2QixDOztBQUsvQjs7O0FBR0F6QixFQUFBQSxXQUFXLEVBQUUvQixTQUFTLENBQUMyRCxNOztBQUV2Qjs7OztBQUlBaEMsRUFBQUEsWUFBWSxFQUFFM0IsU0FBUyxDQUFDeUQsSTs7QUFFeEI7OztBQUdBekIsRUFBQUEsVUFBVSxFQUFFaEMsU0FBUyxDQUFDNEQsTTs7QUFFdEI7OztBQUdBM0IsRUFBQUEsV0FBVyxFQUFFakMsU0FBUyxDQUFDNEQsTTs7QUFFdkI7OztBQUdBekIsRUFBQUEsaUJBQWlCLEVBQUVuQyxTQUFTLENBQUM0RCxNOztBQUU3Qjs7O0FBR0F2QixFQUFBQSxRQUFRLEVBQUVyQyxTQUFTLENBQUMwRCxJOztBQUVwQjs7O0FBR0F0QixFQUFBQSxTQUFTLEVBQUVwQyxTQUFTLENBQUMwRDs7O2dCQTdFSi9DLFEsa0JBZ0ZHO0FBQ3BCaUIsRUFBQUEsS0FBSyxFQUFFLEdBRGE7QUFFcEJNLEVBQUFBLFdBQVcsRUFBRSxLQUZPO0FBR3BCRyxFQUFBQSxRQUFRLEVBQUUsS0FIVTtBQUlwQkQsRUFBQUEsU0FBUyxFQUFFO0FBSlMsQzs7U0FoRkh6QixRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFB1cmVDb21wb25lbnQgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCBCb3gsIHsgZGltZW5zaW9ucywgc3BhY2luZywgcG9zaXRpb24sIGxheW91dCB9IGZyb20gJ3VpLWJveCdcbmltcG9ydCB7IEF1dG9jb21wbGV0ZSB9IGZyb20gJy4uLy4uL2F1dG9jb21wbGV0ZSdcbmltcG9ydCB7IFRleHRJbnB1dCB9IGZyb20gJy4uLy4uL3RleHQtaW5wdXQnXG5pbXBvcnQgeyBJY29uQnV0dG9uIH0gZnJvbSAnLi4vLi4vYnV0dG9ucydcbmltcG9ydCBkZXByZWNhdGVkIGZyb20gJy4uLy4uL2xpYi9kZXByZWNhdGVkJ1xuaW1wb3J0IHsgQ2FyZXREb3duSWNvbiB9IGZyb20gJy4uLy4uL2ljb25zJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21ib2JveCBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIEltcGxlbWVudHMgc29tZSBBUElzIGZyb20gdWktYm94LlxuICAgICAqL1xuICAgIC4uLmRpbWVuc2lvbnMucHJvcFR5cGVzLFxuICAgIC4uLnNwYWNpbmcucHJvcFR5cGVzLFxuICAgIC4uLnBvc2l0aW9uLnByb3BUeXBlcyxcbiAgICAuLi5sYXlvdXQucHJvcFR5cGVzLFxuXG4gICAgLyoqXG4gICAgICogVGhlIG9wdGlvbnMgdG8gc2hvdyBpbiB0aGUgbWVudS5cbiAgICAgKi9cbiAgICBpdGVtczogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VsZWN0ZWQgaXRlbSB3aGVuIGNvbnRyb2xsZWQuXG4gICAgICovXG4gICAgc2VsZWN0ZWRJdGVtOiBQcm9wVHlwZXMuYW55LFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gdmFsdWUgY2hhbmdlcy5cbiAgICAgKi9cbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIG9wZW4gdGhlIGF1dG9jb21wbGV0ZSBvbiBmb2N1cy5cbiAgICAgKi9cbiAgICBvcGVuT25Gb2N1czogUHJvcFR5cGVzLmJvb2wsXG5cbiAgICAvKipcbiAgICAgKiBEZWZhdWx0IHNlbGVjdGVkIGl0ZW0gd2hlbiB1bmNvbnRyb2xsZWQuXG4gICAgICovXG4gICAgaW5pdGlhbFNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcblxuICAgIC8qKlxuICAgICAqIERlZmF1bHQgc2VsZWN0ZWQgaXRlbSB3aGVuIHVuY29udHJvbGxlZCAoZGVwcmVjYXRlZClcbiAgICAgKi9cbiAgICBkZWZhdWx0U2VsZWN0ZWRJdGVtOiBkZXByZWNhdGVkKFxuICAgICAgUHJvcFR5cGVzLmFueSxcbiAgICAgICdVc2UgXCJpbml0aWFsU2VsZWN0ZWRJdGVtXCIgaW5zdGVhZC4nXG4gICAgKSxcblxuICAgIC8qKlxuICAgICAqIFRoZSBwbGFjZWhvbGRlciB0ZXh0IHdoZW4gdGhlcmUgaXMgbm8gdmFsdWUgcHJlc2VudC5cbiAgICAgKi9cbiAgICBwbGFjZWhvbGRlcjogUHJvcFR5cGVzLnN0cmluZyxcblxuICAgIC8qKlxuICAgICAqIEluIGNhc2UgdGhlIGFycmF5IG9mIGl0ZW1zIGlzIG5vdCBhbiBhcnJheSBvZiBzdHJpbmdzLFxuICAgICAqIHRoaXMgZnVuY3Rpb24gaXMgdXNlZCBvbiBlYWNoIGl0ZW0gdG8gcmV0dXJuIHRoZSBzdHJpbmcgdGhhdCB3aWxsIGJlIHNob3duIG9uIHRoZSBmaWx0ZXJcbiAgICAgKi9cbiAgICBpdGVtVG9TdHJpbmc6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogUHJvcGVydGllcyBmb3J3YXJkZWQgdG8gdGhlIGlucHV0LiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgICAqL1xuICAgIGlucHV0UHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgYnV0dG9uLiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgICAqL1xuICAgIGJ1dHRvblByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuXG4gICAgLyoqXG4gICAgICogUHJvcGVydGllcyBmb3J3YXJkZWQgdG8gdGhlIGF1dG9jb21wbGV0ZSBjb21wb25lbnQuIFVzZSB3aXRoIGNhdXRpb24uXG4gICAgICovXG4gICAgYXV0b2NvbXBsZXRlUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgICAvKipcbiAgICAgKiBNYWtlcyB0aGUgaW5wdXQgZWxlbWVudCBkaXNhYmxlZC5cbiAgICAgKi9cbiAgICBkaXNhYmxlZDogUHJvcFR5cGVzLmJvb2wsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIHNob3cgYSBsb2FkaW5nIHNwaW5uZXIuIFRoaXMgYWxzbyBkaXNhYmxlcyB0aGUgYnV0dG9uLlxuICAgICAqL1xuICAgIGlzTG9hZGluZzogUHJvcFR5cGVzLmJvb2xcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgd2lkdGg6IDI0MCxcbiAgICBvcGVuT25Gb2N1czogZmFsc2UsXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIGlzTG9hZGluZzogZmFsc2VcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGlzT3BlbmVkQnlCdXR0b246IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgaGFuZGxlU3RhdGVDaGFuZ2UgPSBjaGFuZ2VzID0+IHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGNoYW5nZXMsICdpc09wZW4nKSkge1xuICAgICAgaWYgKCFjaGFuZ2VzLmlzT3Blbikge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNPcGVuZWRCeUJ1dHRvbjogZmFsc2UgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgaXRlbXMsXG4gICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICBkZWZhdWx0U2VsZWN0ZWRJdGVtLCAvLyBEZXByZWNhdGVkXG4gICAgICBpbml0aWFsU2VsZWN0ZWRJdGVtLFxuICAgICAgaXRlbVRvU3RyaW5nLFxuICAgICAgd2lkdGgsXG4gICAgICBoZWlnaHQsXG4gICAgICBvbkNoYW5nZSxcbiAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgaW5wdXRQcm9wcyxcbiAgICAgIGJ1dHRvblByb3BzLFxuICAgICAgb3Blbk9uRm9jdXMsXG4gICAgICBhdXRvY29tcGxldGVQcm9wcyxcbiAgICAgIGlzTG9hZGluZyxcbiAgICAgIC4uLnByb3BzXG4gICAgfSA9IHRoaXMucHJvcHNcblxuICAgIGNvbnN0IGRpc2FibGVkID0gcHJvcHMuZGlzYWJsZWQgfHwgaXNMb2FkaW5nXG5cbiAgICByZXR1cm4gKFxuICAgICAgPEF1dG9jb21wbGV0ZVxuICAgICAgICBpdGVtcz17aXRlbXN9XG4gICAgICAgIHNlbGVjdGVkSXRlbT17c2VsZWN0ZWRJdGVtfVxuICAgICAgICBpbml0aWFsU2VsZWN0ZWRJdGVtPXtpbml0aWFsU2VsZWN0ZWRJdGVtIHx8IGRlZmF1bHRTZWxlY3RlZEl0ZW19XG4gICAgICAgIGl0ZW1Ub1N0cmluZz17aXRlbVRvU3RyaW5nfVxuICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2V9XG4gICAgICAgIG9uU3RhdGVDaGFuZ2U9e3RoaXMuaGFuZGxlU3RhdGVDaGFuZ2V9XG4gICAgICAgIGlzRmlsdGVyRGlzYWJsZWQ9e3RoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbn1cbiAgICAgICAgey4uLmF1dG9jb21wbGV0ZVByb3BzfVxuICAgICAgPlxuICAgICAgICB7KHtcbiAgICAgICAgICBnZXRSZWYsXG4gICAgICAgICAgaXNTaG93bixcbiAgICAgICAgICBvcGVuTWVudSxcbiAgICAgICAgICBpbnB1dFZhbHVlLFxuICAgICAgICAgIGdldElucHV0UHJvcHMsXG4gICAgICAgICAgZ2V0VG9nZ2xlQnV0dG9uUHJvcHMsXG4gICAgICAgICAgY2xlYXJTZWxlY3Rpb25cbiAgICAgICAgfSkgPT4gKFxuICAgICAgICAgIDxCb3hcbiAgICAgICAgICAgIGlubmVyUmVmPXtyZWYgPT4gZ2V0UmVmKHJlZil9XG4gICAgICAgICAgICBkaXNwbGF5PVwiaW5saW5lLWZsZXhcIlxuICAgICAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0SW5wdXRcbiAgICAgICAgICAgICAgd2lkdGg9ezB9XG4gICAgICAgICAgICAgIGZsZXg9ezF9XG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICB2YWx1ZT17aW5wdXRWYWx1ZX1cbiAgICAgICAgICAgICAgYm9yZGVyVG9wUmlnaHRSYWRpdXM9ezB9XG4gICAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgICAgIHsuLi5nZXRJbnB1dFByb3BzKHtcbiAgICAgICAgICAgICAgICAuLi5pbnB1dFByb3BzLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgICAgIG9uRm9jdXM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChvcGVuT25Gb2N1cykgb3Blbk1lbnUoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICBpc09wZW5lZEJ5QnV0dG9uOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUudHJpbSgpID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHRoZSBzZWxlY3RlZCBpdGVtIGZyb20gc3RpY2tpbmcgYXJvdW5kXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyU2VsZWN0aW9uKClcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgIGNvbG9yPVwibXV0ZWRcIlxuICAgICAgICAgICAgICBpY29uPXtpc0xvYWRpbmcgPyBudWxsIDogQ2FyZXREb3duSWNvbn1cbiAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cImRlZmF1bHRcIlxuICAgICAgICAgICAgICBoZWlnaHQ9e2hlaWdodH1cbiAgICAgICAgICAgICAgbWFyZ2luTGVmdD17LTF9XG4gICAgICAgICAgICAgIHBhZGRpbmdMZWZ0PXtpc0xvYWRpbmcgPyAxMiA6IDB9XG4gICAgICAgICAgICAgIHBhZGRpbmdSaWdodD17MH1cbiAgICAgICAgICAgICAgYm9yZGVyVG9wTGVmdFJhZGl1cz17MH1cbiAgICAgICAgICAgICAgYm9yZGVyQm90dG9tTGVmdFJhZGl1cz17MH1cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ31cbiAgICAgICAgICAgICAgey4uLmdldFRvZ2dsZUJ1dHRvblByb3BzKHtcbiAgICAgICAgICAgICAgICAuLi5idXR0b25Qcm9wcyxcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoIWlzU2hvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlzT3BlbmVkQnlCdXR0b246IHRydWUgfSlcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L0JveD5cbiAgICAgICAgKX1cbiAgICAgIDwvQXV0b2NvbXBsZXRlPlxuICAgIClcbiAgfVxufVxuIl19